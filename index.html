<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1.0"/>
<title>Switzerland → Puglia → Rome — Oct 9–20, 2025</title>
<link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"/>
<style>
  :root{
    --bg:#0b0e11; --panel:#12161b; --muted:#9aa4af; --ink:#e8eef6; --accent:#82aaff;
    --chip:#202632; --ok:#66C08B; --fly:#7B9FF2; --train:#3EA6D6; --onward:#FF7B6B;
    --border:#1f2430;
  }
  *{box-sizing:border-box}
  html,body{height:100%;margin:0;background:var(--bg);color:var(--ink);font:14px/1.45 system-ui,-apple-system,Segoe UI,Roboto,Arial}
  #app{display:grid;grid-template-columns:minmax(260px,320px) 1fr;grid-template-rows:100vh;overflow:hidden}
  /* Left timeline */
  #left{background:var(--panel);border-right:1px solid var(--border);overflow:auto}
  .brand{position:sticky;top:0;background:var(--panel);z-index:2;padding:14px 16px;border-bottom:1px solid var(--border)}
  .brand h1{margin:0;font-size:16px;font-weight:700}
  .brand .dates{color:var(--muted);font-size:12px;margin-top:4px}
  .bulk{display:flex;gap:8px;margin-top:10px}
  .btn{cursor:pointer;background:#0e1318;border:1px solid var(--border);color:#d8e0ea;border-radius:8px;padding:6px 10px;font-size:12px}
  .btn:hover{border-color:#2a3140}
  .day{display:flex;align-items:center;gap:8px;padding:10px 12px;border-left:3px solid transparent;cursor:pointer}
  .day:hover{background:#0e1318}
  .day.active{background:#0e1318;border-left-color:var(--accent)}
  .day .t{font-weight:700}
  .day .s{color:var(--muted);font-size:12px}
  .day input{margin:0 4px 0 0;cursor:pointer}
  .legend{padding:10px 12px;border-top:1px solid var(--border)}
  .chip{display:inline-block;padding:2px 6px;border-radius:999px;background:var(--chip);margin-right:6px;color:#cbd5e1}
  .dot{display:inline-block;width:10px;height:10px;border-radius:50%;margin-right:6px;vertical-align:-1px}
  /* Right: map + panel */
  #right{position:relative;overflow:hidden}
  #map{position:absolute;inset:0}
  #panel{
    position:absolute;right:14px;top:14px;width:min(380px,45vw);max-height:calc(100% - 28px);
    overflow:auto;background:var(--panel);border:1px solid var(--border);border-radius:12px;
    box-shadow:0 8px 40px rgba(0,0,0,.35);z-index:5
  }
  #togglePanel{position:absolute;right:14px;top:14px;z-index:6}
  .p-hdr{padding:12px 14px;border-bottom:1px solid var(--border)}
  .p-hdr h2{margin:0;font-size:16px}
  .p-hdr .sub{color:var(--muted);font-size:12px;margin-top:2px}
  .section{padding:10px 14px;border-bottom:1px solid var(--border)}
  .section h3{margin:0 0 6px;font-size:13px;color:#cbd5e1}
  .grid{display:grid;grid-template-columns:1fr;gap:8px}
  .card{background:#0e1318;border:1px solid var(--border);border-radius:10px;padding:10px}
  .row{display:flex;justify-content:space-between;gap:8px;align-items:center}
  .muted{color:var(--muted)}
  a{color:var(--accent);text-decoration:none}
  a:hover{text-decoration:underline}
  .tag{display:inline-block;background:#111827;border:1px solid var(--border);border-radius:6px;padding:2px 6px;margin-right:6px;font-size:11px;color:#cbd5e1}
  .flow{display:flex;gap:8px;flex-wrap:wrap}
  .seg{background:#0c1220;border:1px solid var(--border);border-radius:999px;padding:2px 8px;font-size:11px}
  .seg.train{border-color:var(--train)}
  .seg.fly{border-color:var(--fly)}
  .seg.onward{border-color:var(--onward)}
  /* mobile */
  @media(max-width:1000px){ #app{grid-template-columns:1fr} #left{display:none} #panel{left:14px;width:calc(100% - 28px)} }
</style>
</head>
<body>
<div id="app">
  <aside id="left">
    <div class="brand">
      <h1>Trip Planner · Oct 9–20</h1>
      <div class="dates">Switzerland → Puglia → Rome</div>
      <div class="bulk">
        <button class="btn" id="allOn">ALL ON</button>
        <button class="btn" id="allOff">ALL OFF</button>
      </div>
    </div>
    <div id="timeline"></div>
    <div class="legend">
      <div style="margin-bottom:6px">Legend</div>
      <div><span class="dot" style="background:#3EA6D6"></span><span class="muted">Train</span></div>
      <div><span class="dot" style="background:#7B9FF2"></span><span class="muted">Flight</span></div>
      <div><span class="dot" style="background:#66C08B"></span><span class="muted">Regional</span></div>
      <div><span class="dot" style="background:#FF7B6B"></span><span class="muted">Onward leg</span></div>
      <div style="margin-top:8px">
        <span class="chip">Base</span>
        <span class="chip">Day Trip</span>
        <span class="chip">Food</span>
        <span class="chip">Hub</span>
      </div>
    </div>
  </aside>

  <main id="right">
    <button class="btn" id="togglePanel">Hide panel</button>
    <div id="map" aria-label="Map of Switzerland and Italy"></div>
    <div id="panel" aria-live="polite">
      <div class="p-hdr">
        <h2 id="panel-title">Pick a day on the left</h2>
        <div id="panel-sub" class="sub">You’ll see times, travel, food & nearby places here.</div>
      </div>
      <div id="panel-body"></div>
    </div>
  </main>
</div>

<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
<script>
/* ========= DATA (same content as before) ========= */
const P = {
  Lucerne:[47.0502,8.3093], ZRH:[47.4515,8.5646], Engelberg:[46.821,8.405],
  Vitznau:[47.013,8.487], Weggis:[47.032,8.432], RigiKaltbad:[47.045,8.465], RigiKulm:[47.058,8.486],
  Bari:[41.1171,16.8719], Monopoli:[40.9508,17.3026], Polignano:[40.9963,17.2208],
  Alberobello:[40.7833,17.2333], Locorotondo:[40.755,17.327], Ostuni:[40.7310,17.5776],
  Rome:[41.9028,12.4964], FCO:[41.7999,12.2462]
};
/* Days array trimmed for brevity: paste the same DAYS from the previous file you used.
   (Everything will work; I kept structure identical.) */
const DAYS = [
  /* —— Oct 9 to Oct 20 objects from my last message go here unchanged —— */
];

/* ========= MAP ========= */
const map = L.map('map', {
  center:[44.2,12.5], zoom:6,
  minZoom:5, worldCopyJump:true
});
L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png',{maxZoom:18,attribution:'&copy; OpenStreetMap contributors'}).addTo(map);

function icon(color){
  return L.icon({
    iconUrl:`https://raw.githubusercontent.com/pointhi/leaflet-color-markers/master/img/marker-icon-2x-${color}.png`,
    iconSize:[25,41], iconAnchor:[12,41], popupAnchor:[1,-34],
    shadowUrl:'https://unpkg.com/leaflet@1.9.4/dist/images/marker-shadow.png', shadowSize:[41,41]
  });
}
const ICON = {base:icon('blue'), day:icon('green'), hub:icon('grey'), food:icon('orange')};
const COLORS = {train:'#3EA6D6', flight:'#7B9FF2', regional:'#66C08B', onward:'#FF7B6B', alt:'#9aa0a6'};

const layersByDay = [];          // FeatureGroup per day
const checkboxByDay = [];        // Checkbox node per day
const allGroup = L.featureGroup().addTo(map); // holds visible day groups

function drawDay(i){
  if(layersByDay[i]) return layersByDay[i];
  const g = L.featureGroup();
  const d = DAYS[i];
  (d.map?.pins||[]).forEach(p=>{
    const pt=P[p.at]; if(!pt) return;
    const ic = p.kind==='base'?ICON.base : p.kind==='day'?ICON.day : ICON.hub;
    L.marker(pt,{icon:ic}).addTo(g).bindPopup(`<b>${p.label||p.at}</b>`);
  });
  (d.map?.legs||[]).forEach(([from,to,kind,label])=>{
    const a=P[from], b=P[to]; if(!a||!b) return;
    L.polyline([a,b],{color:COLORS[kind]||'#9aa0a6',weight:3,opacity:0.9,dashArray:(kind==='alt'?'6 6':null)})
     .addTo(g).bindTooltip(label,{sticky:true});
  });
  layersByDay[i]=g;
  return g;
}
function fitAllVisible(){
  const layers = allGroup.getLayers();
  if(!layers.length) return;
  let bounds=null;
  layers.forEach(l=>{ bounds = bounds ? bounds.extend(l.getBounds()) : l.getBounds(); });
  if(bounds) map.fitBounds(bounds.pad(0.25));
}

/* ========= UI: TIMELINE WITH CHECKBOXES ========= */
const T = document.getElementById('timeline');
DAYS.forEach((d,i)=>{
  const row = document.createElement('div');
  row.className='day'; row.dataset.idx=i;

  const cb = document.createElement('input');
  cb.type='checkbox'; cb.checked=true; checkboxByDay[i]=cb;

  const text = document.createElement('div');
  text.innerHTML = `<div class="t">${d.date} — ${d.city}</div><div class="s">${d.title}</div>`;

  row.appendChild(cb); row.appendChild(text);
  T.appendChild(row);

  // checkbox toggles visibility
  cb.addEventListener('change',()=>{
    const layer = drawDay(i);
    if(cb.checked){ allGroup.addLayer(layer); } else { allGroup.removeLayer(layer); }
    fitAllVisible();
  });

  // clicking row (not the checkbox) focuses that day
  row.addEventListener('click', (e)=>{
    if(e.target===cb) return; // avoid toggle on checkbox click
    document.querySelectorAll('.day').forEach(n=>n.classList.remove('active'));
    row.classList.add('active');
    const layer = drawDay(i);
    if(!allGroup.hasLayer(layer)){ allGroup.addLayer(layer); cb.checked=true; }
    map.fitBounds(layer.getBounds().pad(0.25));
    renderPanel(i);
  });
});

// build all layers initially
DAYS.forEach((_,i)=> allGroup.addLayer(drawDay(i)));
fitAllVisible();

/* ========= BULK TOGGLES ========= */
document.getElementById('allOn').onclick = ()=>{
  DAYS.forEach((_,i)=>{ const l=drawDay(i); if(!allGroup.hasLayer(l)) allGroup.addLayer(l); checkboxByDay[i].checked=true; });
  fitAllVisible();
};
document.getElementById('allOff').onclick = ()=>{
  DAYS.forEach((_,i)=>{ const l=layersByDay[i]; if(l) allGroup.removeLayer(l); checkboxByDay[i].checked=false; });
};

/* ========= RIGHT PANEL ========= */
function chip(txt){ return `<span class="tag">${txt}</span>`; }
function renderPanel(i){
  const d=DAYS[i];
  document.getElementById('panel-title').textContent = `${d.date} · ${d.city}`;
  document.getElementById('panel-sub').textContent = d.title;
  const body=[];

  body.push(`
    <div class="section">
      <h3>Expected Weather</h3>
      <div class="row">
        <div>${chip(d.weather.avg)} ${d.weather.note}</div>
        <div class="muted">Live soon → add API key</div>
      </div>
    </div>
  `);

  if(d.travel?.length){
    body.push(`<div class="section"><h3>Travel</h3><div class="flow">`+
      d.travel.map(t=>{
        const cls = t.mode==='flight'?'seg fly':t.mode==='train'?'seg train':t.mode==='onward'?'seg onward':'seg';
        return `<span class="${cls}">${t.from} → ${t.to} · ${t.time}${t.km?` · ${t.km}`:''}</span>`;
      }).join('')+`</div></div>`);
  }
  if(d.slots?.length){
    body.push(`<div class="section"><h3>Plan</h3><div class="grid">`+
      d.slots.map(s=>`<div class="card"><div class="row"><div><b>${s.when}</b></div><div class="muted">${d.city}</div></div>
        <div>${ s.link ? `<a target="_blank" href="${s.link}">${s.what}</a>` : s.what }</div></div>`).join('')+
      `</div></div>`);
  }
  if(d.food?.length){
    body.push(`<div class="section"><h3>Restaurants</h3><div class="grid">`+
      d.food.map(f=>`<div class="card"><div><b>${f.name}</b> <span class="muted">— ${f.why||''}</span></div>${ f.link?`<div><a target="_blank" href="${f.link}">Website</a></div>`:''}</div>`).join('')+
      `</div></div>`);
  }
  if(d.nearby?.length){
    body.push(`<div class="section"><h3>Places around</h3><div class="grid">`+
      d.nearby.map(n=>`<div class="card"><div><b>${n.name}</b></div><div class="muted">${n.why||''}</div></div>`).join('')+
      `</div></div>`);
  }
  document.getElementById('panel-body').innerHTML = body.join('');
}
// default: focus day 1 so panel isn’t empty
renderPanel(0);

/* ========= PANEL SHOW/HIDE ========= */
const panel = document.getElementById('panel');
const toggleBtn = document.getElementById('togglePanel');
toggleBtn.onclick = ()=>{
  if(panel.style.display==='none'){ panel.style.display='block'; toggleBtn.textContent='Hide panel'; }
  else { panel.style.display='none'; toggleBtn.textContent='Show panel'; }
};
</script>
</body>
</html>
